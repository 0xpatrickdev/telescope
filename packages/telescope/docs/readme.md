# Telescope

<p align="center">
  <img width="280" src="https://user-images.githubusercontent.com/545047/175660665-5cbde84b-0928-4e59-ab56-be6adb2f3a7e.png">
</p>

<p align="center" width="100%">
  <a href="https://github.com/osmosis-labs/telescope/actions/workflows/run-tests.yaml">
    <img height="20" src="https://github.com/osmosis-labs/telescope/actions/workflows/run-tests.yaml/badge.svg" />
  </a>
   <a href="https://github.com/osmosis-labs/telescope/blob/main/LICENSE-MIT"><img height="20" src="https://img.shields.io/badge/license-MIT-blue.svg"></a>
   <a href="https://github.com/osmosis-labs/telescope/blob/main/LICENSE-Apache"><img height="20" src="https://img.shields.io/badge/license-Apache-blue.svg"></a>
   <a href="https://www.npmjs.com/package/@osmonauts/telescope"><img height="20" src="https://img.shields.io/github/package-json/v/osmosis-labs/telescope?filename=packages%2Ftelescope%2Fpackage.json"></a>
</p>

<p align="center">
  <img src="https://user-images.githubusercontent.com/545047/178129981-5a7d18ed-d2b5-4d85-b828-ca084d38501e.png">
</p>

A "babel for the Cosmos", Telescope is a TypeScript Transpiler for Cosmos Protobufs. Telescope is used to generate libraries for Cosmos blockchains. Simply point to your protobuffer files and create developer-friendly Typescript libraries for teams to build on your blockchain.

The following blockchain libraries (generated by Telescope) are available via npm

* [akashjs](https://www.npmjs.com/package/akashjs)
* [comdex](https://www.npmjs.com/package/comdex)
* [osmojs](https://www.npmjs.com/package/osmojs)
* [pylonsjs](https://www.npmjs.com/package/pylonsjs)
* [stargazejs](https://www.npmjs.com/package/stargazejs)

## Table of contents

- [Telescope](#telescope)
  - [Table of contents](#table-of-contents)
- [QuickStart](#quickstart)
- [Usage](#usage)
    - [Programmatic Usage](#programatic-usage)
    - [Options](#options)
    - [Types](#types)
    - [Manually Registering](#manually-registering-types)
- [Sponsors](#sponsors)
- [Development](#development)
- [Related](#related)
- [Credits](#credits)

## Quickstart

Follow the instructions below to generate a new Typescript package that you can publish to npm.

First, install `telescope`:

```sh
npm install -g @osmonauts/telescope
```

### Generate

Use the `generate` command to create a new package. 

```sh
telescope generate
cd ./your-new-project
yarn 
```
### Add Protobufs

If you have `.proto` files, simply add them to a `./proto` folder.

However, if you want to get started quickly using existing protos from our registry, simply use the `install` command.

```sh
telescope install
```

It's not necessary, but you may also specify specific packages, e.g.

```sh
telescope install @protobufs/osmosis
```

### Transpile

To create the Typescript files, run the `transpile` command. 

```sh
telescope transpile
```

You should now seem some `.ts` files generated in `./src`. These are the real source files used in your application.

### Build

Finally, run `install` and `buidl` to generate the JS and types for publishing your module to npm.

```sh
yarn install
yarn buidl
```
# Usage
## Programatic Usage

```js
import { join } from 'path';
import telescope from '@osmonauts/telescope';

const protoDirs = [join(__dirname, '/../proto')];
const outPath = join(__dirname, '../src/proto');

telescope({
  protoDirs,
  outPath,
  options: {
    includeAminos: true,
    includeLCDClients: true,
    includeRpcClients: true,
    camelRpcMethods: true,
    includePackageVar: false,
    useDate: 'date',
    useDuration: 'duration',
    useExact: false,

    // for nested options:
    packages: {
      nebula: {
        useExact: true
      },
      akash: {
        signingClientDefaults: false,
        useExact: false
      }
    }
  }
});
```

## Options

"nestable" means you can provide an option inside of the `TelescopeOption.packages` on a per-package basis, or even a sub-scope of a package.

| env var                  | nestable          | description                                                     |
| ------------------------ | ----------------- | --------------------------------------------------------------  |
| `aminoCasingFn`          | Yes               | set the amino-casing function for a project                     |
| `aminoExceptions`        | No                | set specific aminoType name exceptions                          |
| `aminoTypeUrl`           | No                | create functions for aminoType name exceptions                  |
| `camelRpcMethods`        | No                | use camel-case for RPC methods when generating RPC clients      |
| `includeAminos`          | No                | generate amino types and amino converters                       |
| `includeLCDClients`      | No                | generate LCD clients that can query proto `Query` messages      |
| `includePackageVar`      | No                | export a `protoPackage` variable to indicate package name       |
| `includeRPCClients`      | No                | generate RPC clients that can interact with proto messages      |
| `signingClientDefaults`  | Yes               | if true, will include the cosmjs defaults with stargate clients |
| `useDate`                | No                | use either `date` or `timestamp` for `Timestamp` proto type     |
| `useDuration`            | No                | use either `duration` or `string` for `Duration` proto type     |
| `useExact`               | No                | defaults to false, but if enabled uses the `Exact` TS type      |
| `createLCDBundles`       | No                | will generate factory of scoped bundles of all LCD Clients      |
| `createRPCBundles`       | No                | will generate factory of scoped bundles of all RPC Clients      |
| `lcds`                   | No                | will generate a set of LCD bundles based on parameters          |
| `rpcs`                   | No                | will generate a set of RPC bundles based on parameters          |

## Types

### Timestamp

The representation of `google.protobuf.Timestamp` is configurable by the `useDate` option.

| Protobuf type    | Default/`useDate='date'` | `useDate='timestamp'`                      |
| --------------------------- | ---------------------- | ----------------------------------|
| `google.protobuf.Timestamp` | `Date`                 | `{ seconds: Long, nanos: number }`|

TODO
- [ ] add `useDate='string'` option

### Duration

The representation of `google.protobuf.Duration` is configurable by the `useDuration` option.

| Protobuf type    | Default/`useDuration='duration'` | `useDuration='string'`                      |  |
| --------------------------- | ---------------------- | ------------------------------------ | ---------------- |
| `google.protobuf.Duration` | `{ seconds: Long, nanos: number }`                 | `string` |  |

## Manually registering types

This example is with `osmosis` module in `osmojs`, but it is the same pattern for any module.

NOTE: this is using `@cosmjs/stargate@0.28.4`

```js
import {
    AminoTypes,
    SigningStargateClient
} from '@cosmjs/stargate';
import { Registry } from '@cosmjs/proto-signing';
import { defaultRegistryTypes } from '@cosmjs/stargate';
import { OfflineSigner } from '@cosmjs/proto-signing'
import { osmosis } from 'osmojs';

export const getCustomSigningClient = async ({ rpcEndpoint, signer }: { rpcEndpoint: string, signer: OfflineSigner }) => {
  // registry
  const registry = new Registry(defaultRegistryTypes);

  // aminotypes
  const aminoTypes = new AminoTypes({
    ...osmosis.gamm.v1beta1.AminoConverter,
    ...osmosis.lockup.AminoConverter,
    ...osmosis.superfluid.AminoConverter
  });

  // load the 
  osmosis.gamm.v1beta1.load(registry);
  osmosis.lockup.load(registry);
  osmosis.superfluid.load(registry);

  const client = await SigningStargateClient.connectWithSigner(
    rpcEndpoint,
    signer,
    { registry, aminoTypes }
  );

  return client;
};
```

## Developing

Initial setup

```
yarn 
yarn bootstrap
yarn build
```

Then `cd` into a package and run the tests

```
cd ./packages/ast
yarn test:watch
```

## Sponsors

Kudos to our sponsors:

* [Osmosis](https://osmosis.zone) funded the creation of Telescope.

If you need Telescope customizations or priority support, you can ping me [via email](mailto:pyramation@gmail.com).

## Related

Checkout these related projects:

* [cosmwasm-typescript-gen](https://github.com/CosmWasm/cosmwasm-typescript-gen) for generated CosmWasm contract Typescript classes

## Credits

Thanks to these teams and projects for inspiring Telescope:

* [ts-proto](https://github.com/stephenh/ts-proto)
* [osmosis-frontend](https://github.com/osmosis-labs/osmosis-frontend)
* [keplr-wallet](https://github.com/chainapsis/keplr-wallet)
* [secret.js](https://github.com/scrtlabs/secret.js)

## Disclaimer

AS DESCRIBED IN THE TELESCOPE LICENSES, THE SOFTWARE IS PROVIDED “AS IS”, AT YOUR OWN RISK, AND WITHOUT WARRANTIES OF ANY KIND.

No developer or entity involved in creating Telescope will be liable for any claims or damages whatsoever associated with your use, inability to use, or your interaction with other users of the Telescope code or Telescope CLI, including any direct, indirect, incidental, special, exemplary, punitive or consequential damages, or loss of profits, cryptocurrencies, tokens, or anything else of value.
